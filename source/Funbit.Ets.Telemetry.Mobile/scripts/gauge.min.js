var Funbit;(function(n){(function(n){(function(n){(function(n){var t=function(){function n(n,t){this.firstRun=!0;this.failCount=0;this.minFailCount=2;this.endpointUrl=n;this.refreshDelay=t;this.initialize()}return n.prototype.initialize=function(){this.refreshData()},n.prototype.refreshData=function(){var t=this;$.ajax({url:this.endpointUrl,async:!0,dataType:"json",timeout:n.connectionTimeout}).done(function(n){t.dataRefreshSucceeded(n);t.failCount=0}).fail(function(){t.failCount++;t.failCount>t.minFailCount&&t.dataRefreshFailed("Could not connect to the server")}).always(function(){t.timer=setTimeout(t.refreshData.bind(t),t.refreshDelay)})},n.prototype.formatNumber=function(n,t){for(var i=n+"";i.length<t;)i="0"+i;return i},n.prototype.isoToReadableDate=function(t){var i=new Date(t);return n.dayOfTheWeek[i.getDay()]+" "+this.formatNumber(i.getHours(),2)+":"+this.formatNumber(i.getMinutes(),2)},n.prototype.turnIndicator=function(n,t){var i="."+n;t?$(i).addClass("on"):$(i).removeClass("on")},n.prototype.setMeter=function(n,t,i,r,u,f){var o="."+n,s;t=Math.min(t,r);t=Math.max(t,i);var c=(t-i)/(r-i),e=(f-u)*c+u,l=$(o),h=parseInt($(o).data("prev"));if($(o).data("prev",e),s=function(n){l.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n,"-o-transform":n})},Math.abs(h-e)<(f-u)*.005){s("rotate("+e+"deg)");return}$({a:h}).animate({a:e},{duration:this.refreshDelay*1.1,step:function(n){s("rotate("+n+"deg)")}})},n.prototype.setSpeedometer=function(n){this.setMeter("speedometer-arrow",n,0,140,-114,114)},n.prototype.setTachometer=function(n){this.setMeter("tachometer-arrow",n/100,0,24,-97,97)},n.prototype.setFuel=function(n,t){this.setMeter("fuel-arrow",n,0,t,-96,0)},n.prototype.setTemperature=function(n){this.setMeter("temperature-arrow",n,0,100,-96,0)},n.prototype.setIndicator=function(n,t){var i="."+n;$(i).html(t)},n.prototype.dataRefreshSucceeded=function(t){if(t.connected&&t.gameTime.indexOf(n.minDateValue)==0){this.dataRefreshFailed("Connected, waiting for the drive...");return}if(!t.connected){this.dataRefreshFailed("Waiting for the simulator to run...");return}t.gameTime=this.isoToReadableDate(t.gameTime);t.jobDeadlineTime=this.isoToReadableDate(t.jobDeadlineTime);$(".gauge").hasClass("on")||$(".gauge").addClass("on");$(".time").removeClass("error");this.setIndicator("time",t.gameTime);t.sourceCity.length>0?(this.setIndicator("source",t.sourceCity+" ("+t.sourceCompany+")"),this.setIndicator("destination",t.destinationCity+" ("+t.destinationCompany+")"),this.setIndicator("deadline",t.jobDeadlineTime)):(this.setIndicator("source",""),this.setIndicator("destination",""),this.setIndicator("deadline",""));t.trailerAttached?(this.setIndicator("trailer-mass",t.trailerMass/1e3+"t"),this.setIndicator("trailer-name",t.trailerName)):(this.setIndicator("trailer-mass",""),this.setIndicator("trailer-name",""));this.setIndicator("odometer",(Math.round(t.truckOdometer*10)/10).toFixed(1));this.setIndicator("gear",t.gear>0?"D"+t.gear:t.gear<0?"R":"N");this.turnIndicator("trailer",t.trailerAttached);this.turnIndicator("blinker-left",t.blinkerLeftOn);this.turnIndicator("blinker-right",t.blinkerRightOn);this.turnIndicator("cruise",t.cruiseControlOn);this.turnIndicator("parking-lights",t.lightsParkingOn);this.turnIndicator("highbeam",t.lightsBeamHighOn);this.turnIndicator("lowbeam",t.lightsBeamLowOn&&!t.lightsBeamHighOn);this.setSpeedometer(t.truckSpeed*3.6);this.setTachometer(t.engineRpm);this.setFuel(t.fuel,t.fuelCapacity);this.setTemperature(t.waterTemperature)},n.prototype.dataRefreshFailed=function(n){this.setIndicator("time",n);($(".gauge").hasClass("on")||this.firstRun)&&(this.firstRun=!1,$(".gauge").removeClass("on"),$(".time").addClass("error"),this.setIndicator("source",""),this.setIndicator("destination",""),this.setIndicator("deadline",""),this.setIndicator("trailer-mass",""),this.setIndicator("trailer-name",""),this.setIndicator("odometer",""),this.setIndicator("gear",""),this.turnIndicator("trailer",!1),this.turnIndicator("blinker-left",!1),this.turnIndicator("blinker-right",!1),this.turnIndicator("cruise",!1),this.turnIndicator("parking-lights",!1),this.turnIndicator("highbeam",!1),this.turnIndicator("lowbeam",!1),this.setSpeedometer(0),this.setTachometer(0),this.setFuel(0,1),this.setTemperature(0))},n.dayOfTheWeek=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n.minDateValue="0001-01-01T00:00:00",n.connectionTimeout=5e3,n}();n.Gauge=t})(n.Components||(n.Components={}));var t=n.Components})(n.Telemetry||(n.Telemetry={}));var t=n.Telemetry})(n.Ets||(n.Ets={}));var t=n.Ets})(Funbit||(Funbit={}));