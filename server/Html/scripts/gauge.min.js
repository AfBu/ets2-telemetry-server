var Funbit;(function(n){(function(n){(function(n){(function(n){var t=function(){function n(n,t){this.firstRun=!0;this.failCount=0;this.minFailCount=2;this.endpointSeed=0;this.endpointUrl=n;this.refreshDelay=t;this.initialize()}return n.prototype.initialize=function(){this.refreshData()},n.prototype.refreshData=function(){var t=this,i=this.endpointUrl+"?seed="+this.endpointSeed++;$.ajax({url:i,async:!0,dataType:"json",timeout:n.connectionTimeout}).done(function(n){t.dataRefreshSucceeded(n);t.failCount=0}).fail(function(){t.failCount++;t.failCount>t.minFailCount&&t.dataRefreshFailed("Could not connect to the server")}).always(function(){t.timer=setTimeout(t.refreshData.bind(t),t.refreshDelay)})},n.prototype.formatNumber=function(n,t){for(var i=n+"";i.length<t;)i="0"+i;return i},n.prototype.isoToReadableDate=function(t){var i=new Date(t);return n.dayOfTheWeek[i.getDay()]+" "+this.formatNumber(i.getHours(),2)+":"+this.formatNumber(i.getMinutes(),2)},n.prototype.setMeter=function(n,t,i){var s;typeof i=="undefined"&&(i=null);var f="."+n,r=$(f),e=r.data("min"),i=i?i:r.data("max"),o=r.data("min-angle"),h=r.data("max-angle");t=Math.min(t,i);t=Math.max(t,e);var l=(t-e)/(i-e),u=(h-o)*l+o,c=parseInt($(f).data("prev"));if($(f).data("prev",u),s=function(n){r.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n,"-o-transform":n})},Math.abs(c-u)<(h-o)*.005){s("rotate("+u+"deg)");return}$({a:c}).animate({a:u},{duration:this.refreshDelay*1.1,step:function(n){s("rotate("+n+"deg)")}})},n.prototype.setSpeedometerValue=function(n){this.setMeter("speedometer-arrow",n)},n.prototype.setTachometerValue=function(n){this.setMeter("tachometer-arrow",n/100)},n.prototype.setFuelValue=function(n,t){this.setMeter("fuel-arrow",n,t)},n.prototype.setTemperatureValue=function(n){this.setMeter("temperature-arrow",n)},n.prototype.setIndicatorStatus=function(n,t){var i="."+n;t?$(i).addClass("on"):$(i).removeClass("on")},n.prototype.setIndicatorText=function(n,t){var i="."+n;$(i).html(t)},n.prototype.dataRefreshSucceeded=function(t){if(t.connected&&t.gameTime.indexOf(n.minDateValue)==0){this.dataRefreshFailed("Connected, waiting for the drive...");return}if(!t.connected){this.dataRefreshFailed("Waiting for the simulator to run...");return}t.gameTime=this.isoToReadableDate(t.gameTime);t.jobDeadlineTime=this.isoToReadableDate(t.jobDeadlineTime);$(".gauge").hasClass("on")||$(".gauge").addClass("on");$(".time").removeClass("error");this.setIndicatorText("time",t.gameTime);t.sourceCity.length>0?(this.setIndicatorText("source",t.sourceCity+" ("+t.sourceCompany+")"),this.setIndicatorText("destination",t.destinationCity+" ("+t.destinationCompany+")"),this.setIndicatorText("deadline",t.jobDeadlineTime)):(this.setIndicatorText("source",""),this.setIndicatorText("destination",""),this.setIndicatorText("deadline",""));t.trailerAttached?(this.setIndicatorText("trailer-mass",t.trailerMass/1e3+"t"),this.setIndicatorText("trailer-name",t.trailerName)):(this.setIndicatorText("trailer-mass",""),this.setIndicatorText("trailer-name",""));this.setIndicatorText("odometer",(Math.round(t.truckOdometer*10)/10).toFixed(1));this.setIndicatorText("gear",t.gear>0?"D"+t.gear:t.gear<0?"R":"N");this.setIndicatorStatus("trailer",t.trailerAttached);this.setIndicatorStatus("blinker-left",t.blinkerLeftOn);this.setIndicatorStatus("blinker-right",t.blinkerRightOn);this.setIndicatorStatus("cruise",t.cruiseControlOn);this.setIndicatorStatus("parking-lights",t.lightsParkingOn);this.setIndicatorStatus("highbeam",t.lightsBeamHighOn);this.setIndicatorStatus("lowbeam",t.lightsBeamLowOn&&!t.lightsBeamHighOn);this.setSpeedometerValue(t.truckSpeed*3.6);this.setTachometerValue(t.engineRpm);this.setFuelValue(t.fuel,t.fuelCapacity);this.setTemperatureValue(t.waterTemperature)},n.prototype.dataRefreshFailed=function(n){this.setIndicatorText("time",n);($(".gauge").hasClass("on")||this.firstRun)&&(this.firstRun=!1,$(".gauge").removeClass("on"),$(".time").addClass("error"),this.setIndicatorText("source",""),this.setIndicatorText("destination",""),this.setIndicatorText("deadline",""),this.setIndicatorText("trailer-mass",""),this.setIndicatorText("trailer-name",""),this.setIndicatorText("odometer",""),this.setIndicatorText("gear",""),this.setIndicatorStatus("trailer",!1),this.setIndicatorStatus("blinker-left",!1),this.setIndicatorStatus("blinker-right",!1),this.setIndicatorStatus("cruise",!1),this.setIndicatorStatus("parking-lights",!1),this.setIndicatorStatus("highbeam",!1),this.setIndicatorStatus("lowbeam",!1),this.setSpeedometerValue(0),this.setTachometerValue(0),this.setFuelValue(0,1),this.setTemperatureValue(0))},n.dayOfTheWeek=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n.minDateValue="0001-01-01T00:00:00",n.connectionTimeout=5e3,n}();n.Gauge=t})(n.Components||(n.Components={}));var t=n.Components})(n.Telemetry||(n.Telemetry={}));var t=n.Telemetry})(n.Ets||(n.Ets={}));var t=n.Ets})(Funbit||(Funbit={}));